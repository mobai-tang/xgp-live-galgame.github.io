<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>春日樱庭的执念与温柔</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f9f0ff 0%, #e6f7ff 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            min-height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #ff758c;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        /* 场景描述样式 */
        .scene-description {
            background-color: #f8f9fa;
            border-left: 5px solid #6ab0de;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        /* 对话框样式 */
        .dialogue-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        .character-dialogue {
            background-color: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .character-name {
            display: inline-block;
            background-color: #6ab0de;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .character-name.summer {
            background-color: #9b59b6;
        }
        
        .dialogue-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #333;
        }
        
        .character-avatar {
            position: absolute;
            bottom: -10px;
            right: 15px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            object-fit: cover;
        }
        
        /* 选项样式 */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }
        
        .option-btn {
            background-color: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .option-btn:hover, .option-btn:active {
            background-color: #f0f7ff;
            border-color: #6ab0de;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 176, 222, 0.2);
        }
        
        .option-btn:active {
            transform: translateY(-1px);
        }
        
        .option-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background-color: #6ab0de;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .option-btn:hover::after {
            opacity: 0.3;
        }
        
        /* 角色选择页面 */
        .character-select {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px 0;
        }
        
        .character-card {
            width: 90%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .character-card:hover {
            transform: translateY(-5px);
        }
        
        .character-card.selected {
            box-shadow: 0 0 0 3px #ff758c, 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .character-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .character-info {
            padding: 15px;
        }
        
        .character-info h3 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.3rem;
        }
        
        .character-info p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* 创建名字页面 */
        .name-creation {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            gap: 20px;
        }
        
        .name-input-container {
            width: 100%;
            max-width: 400px;
        }
        
        .name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #6ab0de;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .name-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 176, 222, 0.3);
        }
        
        .btn {
            background: linear-gradient(90deg, #6ab0de 0%, #4a90e2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            max-width: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(106, 176, 222, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 100%);
        }
        
        /* 游戏状态栏 */
        .status-bar {
            display: flex;
            justify-content: space-between;
            background-color: #f8f9fa;
            padding: 12px 20px;
            border-top: 2px solid #e0e0e0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 结局页面 */
        .ending-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            text-align: center;
            gap: 25px;
        }
        
        .ending-title {
            color: #ff758c;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .ending-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .ending-description {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #444;
            max-width: 600px;
        }
        
        .ending-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            max-width: 500px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6ab0de;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* 隐藏元素 */
        .hidden {
            display: none !important;
        }
        
        /* 响应式调整 */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .character-dialogue {
                padding: 15px;
            }
            
            .dialogue-text {
                font-size: 1rem;
            }
            
            .character-avatar {
                width: 50px;
                height: 50px;
            }
            
            .option-btn {
                padding: 14px;
            }
            
            .ending-stats {
                flex-direction: column;
                align-items: center;
            }
        }
        
        /* 心情指示器 */
        .mood-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }
        
        .mood-heart {
            color: #ff6b8b;
            font-size: 0.9rem;
        }
        
        .mood-heart.summer {
            color: #9b59b6;
        }
        
        /* 隐藏触发提示 */
        .hidden-trigger {
            font-size: 0.8rem;
            color: #ff6b8b;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* 选择确认 */
        .selection-confirm {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .confirm-box {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            min-width: 80px;
        }
        
        .confirm-yes {
            background-color: #6ab0de;
            color: white;
        }
        
        .confirm-no {
            background-color: #e0e0e0;
            color: #333;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 危险选项样式 */
        .option-btn.danger {
            border-color: #ff6b6b;
        }
        
        .option-btn.danger:hover {
            background-color: #fff0f0;
            border-color: #ff4757;
        }
        
        /* 结局解锁页面 */
        .endings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
        }
        
        .ending-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .ending-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .ending-card.locked {
            opacity: 0.5;
            background-color: #f5f5f5;
        }
        
        .ending-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .ending-card-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .ending-card-type {
            font-size: 0.8rem;
            color: #666;
            padding: 3px 8px;
            background-color: #f0f0f0;
            border-radius: 10px;
            display: inline-block;
        }
        
        /* 健康度指示器 */
        .health-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .health-low {
            background: linear-gradient(90deg, #ff9800 0%, #ff5722 100%);
        }
        
        .health-critical {
            background: linear-gradient(90deg, #f44336 0%, #d32f2f 100%);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- 游戏标题页 -->
        <div id="title-screen" class="main-content">
            <div class="header">
                <h1>春日樱庭的执念与温柔</h1>
                <div class="subtitle">一场关于爱与选择的浪漫故事 · 18结局版本</div>
            </div>
            
            <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; text-align: center;">
                <div style="font-size: 1.3rem; margin-bottom: 30px; color: #555; line-height: 1.6;">
                    樱花盛开的季节，五位性格各异的女孩，<br>一场命中注定的相遇，18种不同结局等待解锁
                </div>
                
                <div style="width: 200px; height: 200px; background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-radius: 50%; margin-bottom: 30px; display: flex; justify-content: center; align-items: center;">
                    <i class="fas fa-heart" style="font-size: 80px; color: white;"></i>
                </div>
                
                <button id="start-btn" class="btn" style="max-width: 250px;">
                    <i class="fas fa-play" style="margin-right: 10px;"></i>开始游戏
                </button>
                
                <button id="endings-btn" class="btn btn-secondary" style="max-width: 250px; margin-top: 15px;">
                    <i class="fas fa-trophy" style="margin-right: 10px;"></i>查看结局
                </button>
                
                <div style="margin-top: 40px; color: #888; font-size: 0.9rem;">
                    <div style="margin-bottom: 10px;">• 18种不同结局等待解锁</div>
                    <div style="margin-bottom: 10px;">• 新增角色：飒爽毒舌的夏梦</div>
                    <div style="margin-bottom: 10px;">• 包含病娇、修罗场、悲剧等多种结局</div>
                    <div>• 健康度系统，注意身体消耗</div>
                </div>
            </div>
        </div>
        
        <!-- 结局画廊 -->
        <div id="endings-gallery" class="main-content hidden">
            <div class="header">
                <h1>结局画廊</h1>
                <div class="subtitle">已解锁结局：<span id="unlocked-count">0</span>/18</div>
            </div>
            
            <div style="padding: 20px; text-align: center;">
                <div style="margin-bottom: 20px; color: #666;">
                    点击已解锁的结局卡片可以重新查看结局详情
                </div>
                
                <div class="endings-grid" id="endings-grid">
                    <!-- 结局卡片将通过JavaScript动态生成 -->
                </div>
                
                <button id="back-to-title-from-gallery" class="btn" style="margin-top: 30px; max-width: 250px;">
                    <i class="fas fa-arrow-left" style="margin-right: 10px;"></i>返回标题
                </button>
            </div>
        </div>
        
        <!-- 创建名字页面 -->
        <div id="name-creation-screen" class="main-content hidden">
            <div class="header">
                <h1>创建你的角色</h1>
                <div class="subtitle">输入你的名字，开始这场浪漫之旅</div>
            </div>
            
            <div class="name-creation">
                <div style="font-size: 1.2rem; color: #555; margin-bottom: 10px; text-align: center;">
                    请输入你的名字，这将成为故事中大家对你的称呼
                </div>
                
                <div class="name-input-container">
                    <input type="text" id="player-name" class="name-input" placeholder="请输入你的名字" maxlength="10" value="主角">
                    <div style="font-size: 0.9rem; color: #999; text-align: center;">名字长度限制为2-10个字符</div>
                </div>
                
                <button id="confirm-name-btn" class="btn">确认名字</button>
                
                <div style="margin-top: 30px; color: #666; font-size: 1rem; text-align: center; max-width: 500px; line-height: 1.6;">
                    <p>故事发生在暮春时节的「樱见庭」，漫天樱花飞舞，你将与五位女孩相遇，展开一段浪漫而复杂的关系。</p>
                    <p style="margin-top: 10px; color: #ff6b6b; font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> 警告：某些结局可能包含成人内容，请谨慎选择
                    </p>
                </div>
            </div>
        </div>
        
        <!-- 角色选择页面 -->
        <div id="character-select-screen" class="main-content hidden">
            <div class="header">
                <h1>选择你的攻略对象</h1>
                <div class="subtitle">选择一位女孩开始你的故事，其他角色也会在故事中出现</div>
            </div>
            
            <div class="character-select">
                <div style="font-size: 1.1rem; color: #555; margin-bottom: 10px; text-align: center; padding: 0 20px;">
                    请选择一位你想要攻略的女孩，你的选择将影响故事的主线发展
                </div>
                
                <div class="character-card" data-character="白粥">
                    <img src="https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg" alt="白粥" class="character-image">
                    <div class="character-info">
                        <h3>白粥 (25岁)</h3>
                        <p>御姐人设，红发大波浪，身材火辣，性格直率洒脱，毒舌却心软。看似高冷实则会默默照顾身边人。</p>
                        <div class="mood-indicator">
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span>好感度: 30</span>
                        </div>
                    </div>
                </div>
                
                <div class="character-card" data-character="稀音">
                    <img src="https://free.picui.cn/free/2025/12/14/693e44f6b4b9e.jpg" alt="稀音" class="character-image">
                    <div class="character-info">
                        <h3>稀音 (23岁)</h3>
                        <p>究极病娇，黑长直发带浅紫挑染，表面温柔乖巧，实则对你有着极强的执念和占有欲。</p>
                        <div class="mood-indicator">
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span>好感度: 40</span>
                        </div>
                    </div>
                </div>
                
                <div class="character-card" data-character="十一">
                    <img src="https://free.picui.cn/free/2025/12/14/693e381736408.jpg" alt="十一" class="character-image">
                    <div class="character-info">
                        <h3>十一 (18岁)</h3>
                        <p>软萌甜妹，粉发双马尾，性格软乎乎容易害羞，喜欢跟在你身边，让人忍不住想呵护。</p>
                        <div class="mood-indicator">
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span>好感度: 20</span>
                        </div>
                    </div>
                </div>
                
                <div class="character-card" data-character="骑士">
                    <img src="https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg" alt="骑士" class="character-image">
                    <div class="character-info">
                        <h3>骑士 (24岁)</h3>
                        <p>古风摄影爱好者，气质沉稳内敛，拍照技术精湛，说话温和有礼，自带古风侠客的温润气场。</p>
                        <div class="mood-indicator">
                            <span class="mood-heart">❤️</span>
                            <span class="mood-heart">❤️</span>
                            <span>好感度: 25</span>
                        </div>
                    </div>
                </div>
                
                <div class="character-card" data-character="夏梦">
                    <img src="https://free.picui.cn/free/2025/12/15/693ee01c7d8e5.png" alt="夏梦" class="character-image">
                    <div class="character-info">
                        <h3>夏梦 (26岁)</h3>
                        <p>飒爽毒舌御姐，短发干练，穿搭时尚前卫，性格豪爽直接，说话一针见血但内心温暖。</p>
                        <div class="mood-indicator">
                            <span class="mood-heart summer">❤️</span>
                            <span class="mood-heart summer">❤️</span>
                            <span class="mood-heart summer">❤️</span>
                            <span>好感度: 35</span>
                        </div>
                    </div>
                </div>
                
                <button id="confirm-character-btn" class="btn" style="margin-top: 20px;">确认选择</button>
                
                <div class="hidden-trigger" style="margin-top: 10px;">
                    <i class="fas fa-exclamation-circle"></i> 选择后仍可与其他角色互动，可能触发隐藏剧情
                </div>
            </div>
        </div>
        
        <!-- 游戏主界面 -->
        <div id="game-screen" class="main-content hidden">
            <!-- 场景描述 -->
            <div id="scene-description" class="scene-description">
                暮春时节，城郊「樱见庭」——漫山樱花盛放，粉白花瓣铺满地。你们刚完成第一轮外景拍摄，围坐在观景台的石桌旁休息。
            </div>
            
            <!-- 对话容器 -->
            <div id="dialogue-container" class="dialogue-container">
                <!-- 对话将通过JavaScript动态添加 -->
            </div>
            
            <!-- 选项容器 -->
            <div id="options-container" class="options-container">
                <!-- 选项将通过JavaScript动态添加 -->
            </div>
        </div>
        
        <!-- 结局页面 -->
        <div id="ending-screen" class="main-content hidden">
            <div class="ending-container">
                <!-- 结局内容将通过JavaScript动态添加 -->
            </div>
        </div>
        
        <!-- 游戏状态栏 -->
        <div id="status-bar" class="status-bar hidden">
            <div class="status-item">
                <i class="fas fa-user"></i>
                <span id="player-name-display">主角</span>
            </div>
            <div class="status-item">
                <i class="fas fa-heart" style="color: #ff6b8b;"></i>
                <span id="main-character-display">未选择</span>
            </div>
            <div class="status-item">
                <i class="fas fa-heartbeat" style="color: #4CAF50;"></i>
                <span>健康度: <span id="health-display">100</span>%</span>
                <div class="health-bar" style="width: 60px; margin-left: 5px;">
                    <div id="health-fill" class="health-fill" style="width: 100%;"></div>
                </div>
            </div>
            <div class="status-item">
                <i class="fas fa-route"></i>
                <span id="route-display">主线</span>
            </div>
        </div>
    </div>

    <!-- 选择确认弹窗 -->
    <div id="selection-confirm" class="selection-confirm hidden">
        <div class="confirm-box">
            <h3 id="confirm-title" style="margin-bottom: 15px; color: #333;">确认选择</h3>
            <p id="confirm-text" style="color: #555; line-height: 1.5;">你确定要选择这个选项吗？你的选择将影响故事走向。</p>
            <div class="confirm-buttons">
                <button id="confirm-yes" class="confirm-btn confirm-yes">确定</button>
                <button id="confirm-no" class="confirm-btn confirm-no">取消</button>
            </div>
        </div>
    </div>

    <script>
        // ==============================
        // 游戏数据
        // ==============================
        const gameData = {
            playerName: "主角",
            selectedCharacter: null,
            relationships: {
                白粥: {好感度: 30, 状态: "普通朋友", 解锁事件: 0, 性格: "直率洒脱，毒舌心软，御姐"},
                稀音: {好感度: 40, 状态: "普通朋友", 解锁事件: 0, 性格: "病娇，占有欲强"},
                十一: {好感度: 20, 状态: "普通朋友", 解锁事件: 0, 性格: "软萌甜妹"},
                骑士: {好感度: 25, 状态: "普通朋友", 解锁事件: 0, 性格: "温柔沉稳"},
                夏梦: {好感度: 35, 状态: "普通朋友", 解锁事件: 0, 性格: "飒爽毒舌"}
            },
            currentScene: 0,
            currentRoute: "主线",
            health: 100,
            endingsUnlocked: [],
            hiddenTriggered: false,
            choices: [],
            staminaConsumed: 0,
            
            // 保存到localStorage
            save() {
                const saveData = {
                    playerName: this.playerName,
                    selectedCharacter: this.selectedCharacter,
                    relationships: this.relationships,
                    currentScene: this.currentScene,
                    currentRoute: this.currentRoute,
                    health: this.health,
                    endingsUnlocked: this.endingsUnlocked,
                    hiddenTriggered: this.hiddenTriggered,
                    choices: this.choices,
                    staminaConsumed: this.staminaConsumed
                };
                localStorage.setItem('galgameSave', JSON.stringify(saveData));
            },
            
            // 从localStorage加载
            load() {
                const saved = localStorage.getItem('galgameSave');
                if (saved) {
                    const saveData = JSON.parse(saved);
                    this.playerName = saveData.playerName || "主角";
                    this.selectedCharacter = saveData.selectedCharacter;
                    this.relationships = saveData.relationships || this.relationships;
                    this.currentScene = saveData.currentScene || 0;
                    this.currentRoute = saveData.currentRoute || "主线";
                    this.health = saveData.health || 100;
                    this.endingsUnlocked = saveData.endingsUnlocked || [];
                    this.hiddenTriggered = saveData.hiddenTriggered || false;
                    this.choices = saveData.choices || [];
                    this.staminaConsumed = saveData.staminaConsumed || 0;
                    return true;
                }
                return false;
            },
            
            // 重置游戏
            reset() {
                this.playerName = "主角";
                this.selectedCharacter = null;
                this.relationships = {
                    白粥: {好感度: 30, 状态: "普通朋友", 解锁事件: 0, 性格: "直率洒脱，毒舌心软，御姐"},
                    稀音: {好感度: 40, 状态: "普通朋友", 解锁事件: 0, 性格: "病娇，占有欲强"},
                    十一: {好感度: 20, 状态: "普通朋友", 解锁事件: 0, 性格: "软萌甜妹"},
                    骑士: {好感度: 25, 状态: "普通朋友", 解锁事件: 0, 性格: "温柔沉稳"},
                    夏梦: {好感度: 35, 状态: "普通朋友", 解锁事件: 0, 性格: "飒爽毒舌"}
                };
                this.currentScene = 0;
                this.currentRoute = "主线";
                this.health = 100;
                this.endingsUnlocked = [];
                this.hiddenTriggered = false;
                this.choices = [];
                this.staminaConsumed = 0;
                localStorage.removeItem('galgameSave');
            },
            
            // 消耗体力
            consumeStamina(amount) {
                this.staminaConsumed += amount;
                this.health = Math.max(0, 100 - Math.min(100, this.staminaConsumed));
                this.save();
                return this.health;
            },
            
            // 恢复体力
            restoreHealth(amount) {
                this.staminaConsumed = Math.max(0, this.staminaConsumed - amount);
                this.health = Math.max(0, 100 - Math.min(100, this.staminaConsumed));
                this.save();
                return this.health;
            }
        };
        
        // ==============================
        // 18个结局数据
        // ==============================
        const gameEndings = {
            // 1. 稀音病娇结局
            "稀音病娇结局": {
                标题: "你只能是我的",
                图片: "https://free.picui.cn/free/2025/12/14/693e44f6b4b9e.jpg",
                描述: `稀音的执念最终战胜了理智。在一个雨夜，你醒来发现自己被锁在一个陌生的房间里。稀音温柔地抚摸着你的脸，轻声说："主角哥哥，这样你就永远是我的了。我不会让任何人抢走你，白粥姐姐不行，十一妹妹也不行，骑士哥哥更不行。从今以后，你只能看着我，只能想着我，只能爱我一个人。"<br><br>起初你试图反抗，但稀音的偏执超乎你的想象。她辞去了工作，全心全意地"照顾"你。房间里摆满了你们的照片，每一张都被她精心装饰。她每天都会为你做饭，陪你说话，但绝不允许你离开这个房间半步。<br><br>日子一天天过去，你渐渐放弃了逃跑的念头。稀音的温柔与偏执交织在一起，形成了一种扭曲的爱。你成为了她世界中心的唯一存在，而她成为了你与外界联系的唯一桥梁。在这个被精心打造的牢笼里，你们的关系变成了一种病态的共生。`,
                类型: "病娇",
                图标: "fas fa-lock",
                解锁条件: () => gameData.relationships.稀音.好感度 >= 100 && gameData.currentRoute === "病娇"
            },
            
            // 2. 五人修罗场结局
            "五人修罗场结局": {
                标题: "甜蜜的负担",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `你做出了一个大胆的决定——尝试同时与五位女孩保持关系。这需要惊人的时间管理能力和演技，但你竟然在最初几个月里成功了。<br><br>白粥发现了你的秘密，但她没有像稀音那样偏执，而是直率地对你说："哟，某人这是要开后宫啊？不过我可警告你，要是让我发现你冷落了谁，我可不会轻易放过你。"她的毒舌下藏着关心，经常帮你打掩护，甚至在你累倒时第一个送你去医院。<br><br>稀音虽然偶尔还会吃醋，但在白粥的"监管"下，她的病娇倾向得到了控制。十一依然软萌可爱，骑士温柔体贴，夏梦毒舌但可靠。五个人达成了一种微妙的平衡。<br><br>但这样的生活对你的消耗是巨大的。你开始出现黑眼圈，体重下降。白粥第一个发现你的异常："喂，你这黑眼圈快赶上熊猫了，要不要休息几天？"但稀音马上反驳："不行，主角哥哥今天要陪我..."<br><br>最终，你在一个清晨彻底晕倒。醒来时，五个女孩都守在床边。白粥第一个开口："看来我们需要制定一个更合理的排班表了。"夏梦毒舌补充："早就说了，这小子迟早被你们榨干。"<br><br>你们达成了一个协议：每周有两天休息日，其他时间轮流陪伴。虽然疲惫，但这种被五个优秀女孩深爱着的感觉，让你既幸福又无奈。`,
                类型: "修罗场",
                图标: "fas fa-users",
                解锁条件: () => {
                    const rel = gameData.relationships;
                    return rel.白粥.好感度 >= 70 && rel.稀音.好感度 >= 70 && 
                           rel.十一.好感度 >= 70 && rel.骑士.好感度 >= 70 &&
                           rel.夏梦.好感度 >= 70 && gameData.staminaConsumed >= 50;
                }
            },
            
            // 3. 白粥专属结局
            "白粥专属结局": {
                标题: "御姐的直率之爱",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `你选择了与白粥在一起。这段关系充满了直率的对话和互怼的乐趣，但你也发现了她毒舌下的温柔。<br><br>白粥不会说甜言蜜语，但她会用行动表达关心。你加班时，她会"顺便"给你带夜宵，然后吐槽："某人这是要修仙啊？"你生病时，她会一边骂你"不知道照顾自己"，一边为你熬粥。<br><br>她的直率让你感到轻松，不需要猜测她的心思。当她高兴时，会直接说："今天心情不错，请你吃饭。"当她生气时，也会直接告诉你原因："你今天和稀音走得太近了，我不高兴。"<br><br>你们的关系像好朋友一样轻松，又像恋人一样亲密。她教会你直面自己的感情，不要拐弯抹角。几年后，当她向你求婚时，说的话也是那么直率："喂，我们结婚吧。虽然你这人毛病不少，但勉强还能忍受。"<br><br>你笑着点头，知道这个看似高冷的御姐，已经把所有的温柔都给了你。`,
                类型: "纯爱",
                图标: "fas fa-crown",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 80
            },
            
            // 4. 稀音治愈结局
            "稀音治愈结局": {
                标题: "执念的蜕变",
                图片: "https://free.picui.cn/free/2025/12/14/693e44f6b4b9e.jpg",
                描述: `在你的耐心陪伴下，稀音逐渐走出了偏执的阴影。她开始接受心理咨询，学习如何健康地表达爱意。<br><br>白粥也在这个过程中帮了不少忙，她用直率的方式开导稀音："喜欢一个人不是要把他关起来，而是要让他自由地选择你。"<br><br>稀音重新找到了工作，在一家花店当店员。她温柔的性格和审美眼光让她很快成为了店里的明星员工。每天下班后，她都会带一束花回家，有时是给你的，有时是装饰你们的家。<br><br>你们一起养了一只猫，稀音给它起名叫"樱花"。看着稀音温柔地照顾猫咪的样子，你知道她已经真正改变了。她的执念转化为了对生活的热爱。<br><br>某个春日的午后，稀音在樱见庭向你求婚。她说："主角哥哥，是你让我学会了什么是健康的爱。现在，我想用我的一生来爱你，但不会束缚你。"你微笑着点头，樱花落在你们的肩上。`,
                类型: "治愈",
                图标: "fas fa-heart",
                解锁条件: () => gameData.relationships.稀音.好感度 >= 80 && gameData.currentRoute !== "病娇"
            },
            
            // 5. 十一专属结局
            "十一专属结局": {
                标题: "甜妹的依赖",
                图片: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg",
                描述: `与十一在一起的日子充满了甜蜜和温暖。她总是用软糯的声音叫着"主角哥哥"，用崇拜的眼神看着你。<br><br>白粥偶尔会来调侃你们："哟，小十一今天又粘着某人了？"十一会红着脸躲到你身后，小声说："白粥姐姐又取笑我..."<br><br>十一顺利完成了学业，选择了摄影专业。你常常陪她去各地采风，看着她从害羞的少女成长为自信的摄影师。她的作品总是充满温暖和希望。<br><br>毕业后，十一开了一家小小的摄影工作室，专门拍摄情侣和家庭照。你成为了她的专属模特和助手。工作室的墙上挂满了你们的照片。<br><br>某个纪念日，十一为你准备了一个惊喜——一本厚厚的相册，里面是从你们相识到现在每一张有你的照片。"主角哥哥，"她红着脸说，"我的镜头里永远只会有你。"你将她拥入怀中。`,
                类型: "纯爱",
                图标: "fas fa-camera",
                解锁条件: () => gameData.relationships.十一.好感度 >= 80
            },
            
            // 6. 骑士专属结局
            "骑士专属结局": {
                标题: "温柔的守候",
                图片: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg",
                描述: `你选择了与骑士在一起。这段关系开始时很平淡，像细水长流，但随着时间的流逝，你越发感受到其中的深度和温暖。<br><br>骑士总是温和有礼，细心周到。他会记得你的每一个喜好，在你需要时默默出现。<br><br>白粥对你们的关系表示支持："骑士这人还不错，至少比那些浮躁的家伙强。"<br><br>骑士的古风摄影工作室越来越有名气，而你成为了他最得力的助手和最默契的模特。你们一起参加汉服活动，学习传统文化。<br><br>某个秋日的黄昏，骑士带你回到樱见庭。樱花早已凋谢，但枫叶正红。他单膝跪地，手中拿着一枚古风玉佩："愿以此佩，许你一生。青山为证，日月为鉴。"你接过玉佩。`,
                类型: "古风",
                图标: "fas fa-gem",
                解锁条件: () => gameData.relationships.骑士.好感度 >= 80
            },
            
            // 7. 夏梦专属结局
            "夏梦专属结局": {
                标题: "毒舌的温柔",
                图片: "https://free.picui.cn/free/2025/12/15/693ee01c7d8e5.png",
                描述: `你选择了与夏梦在一起。这段关系充满了火花，夏梦的毒舌从未停止，但你渐渐学会了欣赏她毒舌背后的温柔。<br><br>夏梦不会像其他女孩那样甜言蜜语，但她会在你熬夜工作时，默默煮一壶咖啡放在你手边；会在你生病时，一边骂你"不知道照顾自己"一边为你熬粥。<br><br>白粥和夏梦经常互怼："老梦你这张嘴就不能甜一点？""得了吧，总比你装高冷强。"<br><br>她的个人摄影展大获成功，你作为她的"特邀嘉宾"和灵感缪斯，出现在了每一篇报道中。夏梦在获奖感言中说："感谢某个不怕我毒舌的傻子，让我知道盔甲下面也可以有柔软。"<br><br>你们的关系就像一场精彩的辩论赛，永远充满活力。夏梦教会你直面生活的锋利，而你让她学会了偶尔放下盔甲。`,
                类型: "飒爽",
                图标: "fas fa-comment-dots",
                解锁条件: () => gameData.relationships.夏梦.好感度 >= 80
            },
            
            // 8. 全员榨干结局
            "全员榨干结局": {
                标题: "夜晚的约定",
                图片: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg",
                描述: `在一个特别的夜晚，五位女孩达成了共识：既然无法独自拥有你，那就共享。但白粥提出了条件："我同意共享，但得按规矩来。谁要是用下作手段，我可不会客气。"<br><br>她们制定了一个详细的排班表，但执行起来却出了意外。稀音想独占你，夏梦毒舌吐槽，十一不知所措，骑士温柔劝说，而白粥则负责维持秩序。<br><br>"稀音，说好的一人一天，你这是什么意思？"白粥直率地质问。<br><br>"我...我只是想多陪主角哥哥一会儿..."稀音委屈地说。<br><br>最终，她们决定用更"公平"的方式——每周抽签决定顺序。但你发现，无论抽签结果如何，你每晚都不得安宁。<br><br>一个月后，你彻底累倒了。白粥第一个发现，立刻叫停了这种荒唐的安排："够了！看看他成什么样了！从今天起，每周一三五休息，二四六日轮流，谁有意见就退出！"<br><br>在她的强势管理下，秩序终于恢复。但你明白，这样的"幸福"既是甜蜜，也是负担。`,
                类型: "成人",
                图标: "fas fa-moon",
                解锁条件: () => {
                    const rel = gameData.relationships;
                    return rel.白粥.好感度 >= 60 && rel.稀音.好感度 >= 60 && 
                           rel.十一.好感度 >= 60 && rel.骑士.好感度 >= 60 &&
                           rel.夏梦.好感度 >= 60 && gameData.staminaConsumed >= 80;
                }
            },
            
            // 9. 意外离世结局
            "意外离世结局": {
                标题: "樱花下的永别",
                图片: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg",
                描述: `那是一个樱花盛开的午后，你和女孩们约好在樱见庭进行最后一次拍摄。大家都很开心。<br><br>拍摄进行到一半时，你为了拍下一张完美的照片，爬上了一棵较高的樱花树。女孩们在下面担心地看着你。<br><br>"主角哥哥，小心一点！"十一在下面喊道。<br><br>"没事的，就快拍好了。"你回答道，伸手去够一枝开得特别灿烂的樱花。<br><br>就在这时，脚下的树枝突然断裂。你失去平衡，从树上摔了下来。<br><br>你被紧急送往医院，但伤势过重。在医院的病床上，五个女孩都围在你身边。<br><br>"你这笨蛋..."白粥咬着嘴唇，努力不让自己哭出声，"爬什么树..."<br><br>你微笑着看着她们，用最后的力气说："对不起...要食言了..."<br><br>你的手无力地垂下。五个女孩的哭声在病房里回荡。<br><br>一年后，她们在樱见庭为你立了一块墓碑。每当樱花盛开时，她们都会一起来看你。`,
                类型: "悲剧",
                图标: "fas fa-cross",
                解锁条件: () => gameData.health <= 20 && Math.random() < 0.3
            },
            
            // 10. 孤独结局
            "孤独结局": {
                标题: "一个人的樱花",
                图片: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg",
                描述: `你选择了委婉地拒绝所有人。白粥直率地说："行吧，既然这是你的选择。"然后潇洒地转身离开。<br><br>稀音哭得很伤心，但在白粥的劝说下逐渐接受了现实。十一红着眼睛说会等你，骑士表示理解，夏梦毒舌地说："早就知道你小子没这个胆量。"<br><br>你们仍然保持朋友关系。樱花盛开时，你独自一人来到樱见庭，看着漫天飞舞的花瓣。<br><br>有时白粥会"偶遇"你，吐槽一句："还在怀念过去啊？"然后陪你坐一会儿，什么也不说。<br><br>你知道，有些人注定只能错过。但那些美好的回忆，会永远留在心中。`,
                类型: "现实",
                图标: "fas fa-user",
                解锁条件: () => {
                    const rel = gameData.relationships;
                    return rel.白粥.好感度 <= 50 && rel.稀音.好感度 <= 50 && 
                           rel.十一.好感度 <= 50 && rel.骑士.好感度 <= 50 &&
                           rel.夏梦.好感度 <= 50;
                }
            },
            
            // 11. 白粥友情结局
            "白粥友情结局": {
                标题: "最好的朋友",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `你和白粥最终选择了做最好的朋友。她直率地说："其实这样更好。恋人可能会分手，但好朋友可以一辈子。"<br><br>她依然是那个毒舌心软的御姐，会在你迷茫时直言不讳地指出问题，在你得意时泼冷水让你保持清醒，在你失意时默默地陪着你。<br><br>她帮你撮合了和其他女孩的关系，用她独特的方式让稀音学会放手，让十一变得更自信，让骑士更主动，让夏梦更温柔。<br><br>多年后，当你终于找到真爱时，她是第一个祝福你的人："终于开窍了啊，某人。要是敢对不起人家，我可不会放过你。"<br><br>你们的关系超越了爱情，成为了彼此生命中最特别的存在。这种友情，有时候比爱情更长久，更珍贵。`,
                类型: "友情",
                图标: "fas fa-handshake",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 70 && gameData.relationships.白粥.好感度 < 80
            },
            
            // 12. 白粥事业结局
            "白粥事业结局": {
                标题: "御姐的征途",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `白粥选择了事业。她对你说："爱情很重要，但我的梦想也很重要。我不想为了任何人放弃自己的追求。"<br><br>她成为了国际知名的摄影师，在世界各地举办摄影展。每次回国，她都会找你吃饭，吐槽各地的见闻，也听取你的建议。<br><br>你们保持着一种特别的关系——不是恋人，但比普通朋友更亲密。她会在深夜打电话跟你讨论创意，会在获奖后第一个告诉你，会在疲惫时找你倾诉。<br><br>十年后，她成为了行业内的传奇人物。在一次采访中，记者问她有没有遗憾，她笑着说："有啊，没能早点遇到某个懂我的人。不过现在这样也不错，自由自在。"<br><br>你知道，这就是白粥——永远直率，永远追求自我，永远活得精彩。`,
                类型: "事业",
                图标: "fas fa-briefcase",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 60 && gameData.currentRoute === "事业"
            },
            
            // 13. 白粥保护者结局
            "白粥保护者结局": {
                标题: "大姐头的守护",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `白粥成为了所有人的大姐头。当她发现稀音的偏执、十一的软弱、骑士的犹豫、夏梦的尖锐时，她决定站出来保护大家。<br><br>"从今天起，谁都不许欺负我们这个小团体。"她直率地宣布，"稀音，不准再搞那些偏执的把戏。十一，学着坚强一点。骑士，该强硬时要强硬。夏梦，毒舌也要分场合。"<br><br>她组织每周的聚会，调解大家的矛盾，在你疲惫时帮你挡掉不必要的麻烦。她就像这个团体的粘合剂，把五个性格迥异的人凝聚在一起。<br><br>当你问她为什么这么做时，她淡淡地说："看不惯你们这群笨蛋互相伤害而已。"<br><br>但在一个雨夜，当她喝醉时，你听到了她的真心话："其实...我只是不想再看到任何人受伤了..."<br><br>这就是白粥，用毒舌伪装温柔，用强势掩饰关心，永远默默守护着身边的人。`,
                类型: "守护",
                图标: "fas fa-shield-alt",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 75 && 
                       gameData.relationships.稀音.好感度 >= 60 && 
                       gameData.relationships.十一.好感度 >= 60
            },
            
            // 14. 白粥青梅竹马结局
            "白粥青梅竹马结局": {
                标题: "多年的默契",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `在一次偶然的对话中，你们发现彼此竟然是失散多年的青梅竹马。白粥难得地露出了温柔的表情："原来是你啊...那个爱哭的小不点。"<br><br>童年的回忆涌上心头，你们重新找回了当年的默契。她不再只是毒舌的御姐，而是在你面前展现出了最真实的一面——会脆弱，会撒娇，会怀念过去。<br><br>"你知道吗，"有一次她靠在你的肩膀上，轻声说，"这些年我一直记得你。所以再次见到你时，才会那么想靠近，又害怕被拒绝，只能用毒舌来掩饰。"<br><br>你们的关系自然而然地发展成了恋人。既有青梅竹马的默契，又有成年人的成熟。她依然会毒舌吐槽你，但你看到了那背后的深情。<br><br>在一个樱花盛开的日子，你们回到了小时候常去的公园。她看着你，难得认真地说："这一次，我不会再让你走丢了。"`,
                类型: "重逢",
                图标: "fas fa-history",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 85 && Math.random() < 0.2
            },
            
            // 15. 白粥开放式关系结局
            "白粥开放式关系结局": {
                标题: "现代的爱情观",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `白粥提出了一个大胆的想法："为什么一定要独占呢？我们可以尝试开放式关系。"<br><br>你震惊地看着她，她却很坦然："爱情不是占有，而是彼此成全。我们可以在一起，但不需要绑死对方。"<br><br>起初你无法接受，但在她的开导下，你开始理解这种现代的爱情观。她不会追问你和谁见面，不会查看你的手机，给你充分的自由。<br><br>"我信任你，"她说，"也信任我自己。如果你选择了别人，那说明我们缘分已尽。但在此之前，让我们享受在一起的每一刻。"<br><br>这种关系模式让你们都感到轻松。没有压力，没有猜忌，只有纯粹的吸引和陪伴。偶尔也会有争吵，但总是能坦诚沟通解决。<br><br>多年后，当朋友问起你们的感情时，白粥依然直率："我们在一起，但也保持独立。这样很好，不是吗？"`,
                类型: "现代",
                图标: "fas fa-infinity",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 70 && 
                       gameData.currentRoute === "开放"
            },
            
            // 16. 白粥离别结局
            "白粥离别结局": {
                标题: "潇洒的转身",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `白粥收到了国外著名摄影工作室的邀请。她犹豫了很久，最终还是决定去追求梦想。<br><br>"我要走了，"她直率地告诉你，"可能会去很久，也可能再也不回来。"<br><br>你问她能不能不走，她摇了摇头："如果为了爱情放弃梦想，那我就不再是我了。"<br><br>离别的那天，她没有哭，只是用力抱了你一下，然后潇洒地转身："别这副表情，说不定我哪天就回来了。"<br><br>但她没有回头，你知道她不想让你看到她的眼泪。<br><br>多年后，你在国际摄影杂志上看到她的专访。照片上的她依然自信洒脱，但眼中多了一份成熟的温柔。记者问她有没有遗憾，她笑了笑："有啊，但我不后悔。人生就是这样，有得有失。"<br><br>你知道，那个毒舌心软的御姐，正在世界的某个角落，活成她想要的样子。`,
                类型: "离别",
                图标: "fas fa-plane",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 65 && 
                       gameData.currentRoute === "离别"
            },
            
            // 17. 白粥共同成长结局
            "白粥共同成长结局": {
                标题: "并肩的旅程",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `你和白粥决定暂时不谈爱情，先专注于各自的成长。她直率地说："现在的我们还不够成熟，等我们都变得更好了，再考虑在一起。"<br><br>你们约定三年时间，各自追求事业，但保持联系，互相鼓励。她出国深造摄影技术，你在国内发展事业。<br><br>三年里，你们每周视频通话，她吐槽国外的食物难吃，你吐槽工作的压力。虽然隔着时差，但心却越来越近。<br><br>三年后，她学成归来，你也事业小成。在樱见庭的重逢，她看着你，难得温柔地说："你变了，变得更好了。"<br><br>你也看着她："你也是，但有些东西没变。"<br><br>她笑了："比如我的毒舌？"<br><br>"比如你的心软。"你回答。<br><br>这一次，你们都准备好了。不是因为寂寞，不是因为冲动，而是因为彼此都成为了更好的人，所以能够更好地相爱。`,
                类型: "成长",
                图标: "fas fa-seedling",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 80 && 
                       gameData.currentRoute === "成长"
            },
            
            // 18. 白粥家庭结局
            "白粥家庭结局": {
                标题: "家的温暖",
                图片: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg",
                描述: `白粥展现出了你从未见过的温柔一面。当你生病住院时，她请了长假照顾你，每天变着花样做营养餐。<br><br>"别误会，"她依然嘴硬，"我只是不想欠你人情。"<br><br>但在你睡着时，她会轻轻抚摸你的额头，眼神温柔得让人心疼。护士都羡慕地说："你女朋友对你真好。"<br><br>康复后，你们的关系发生了微妙的变化。她不再只是毒舌调侃，而是开始关心你的日常生活，提醒你按时吃饭，天冷加衣。<br><br>某个周末，你发现她竟然在学做饭，厨房里一片狼藉。她红着脸解释："总不能一直吃外卖..."<br><br>你从背后抱住她，轻声说："谢谢。"<br><br>她身体一僵，然后放松下来，难得诚实地说："其实...我早就想这么做了。只是害怕被拒绝，所以一直用毒舌来伪装。"<br><br>你们组成了一个温暖的小家。她依然是那个直率的御姐，但只对你展现最柔软的一面。`,
                类型: "家庭",
                图标: "fas fa-home",
                解锁条件: () => gameData.relationships.白粥.好感度 >= 90 && 
                       gameData.health <= 30
            }
        };

        // ==============================
        // 游戏场景数据
        // ==============================
        const gameScenes = {
            0: {
                场景描述: "风卷着樱花花瓣落在石桌的茶盏边缘，泛起一圈浅浅的涟漪。骑士刚收起相机镜头盖，转头就看到十一踮着脚尖，盯着三脚架上的相机屏幕。",
                对话: [
                    {角色: "十一", 文本: "骑士哥哥，刚刚拍的照片也太好看了吧！你把樱花落在白粥姐姐头发上的样子拍得好温柔，还有主角哥哥站在樱树下的画面，好像从古风小说里走出来的人一样，我、我可以再看一眼吗？", 头像: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg"},
                    {角色: "骑士", 文本: "当然可以，要是有喜欢的画面，我之后可以导出来发给你。刚刚拍你的时候，你抱着绣球花笑的样子很上镜，花瓣落在你发饰上，光影刚好，成片效果比预想中更好。", 头像: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg"},
                    {角色: "十一", 文本: "没、没有啦…我刚刚还紧张到忘记摆姿势，多亏主角哥哥一直在旁边温柔提醒我，不然肯定拍得很丑…", 头像: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg"},
                    {角色: "白粥", 文本: "哟，我们十一这是害羞了？刚刚拍互动镜头的时候，你抱着主角的胳膊，笑得眼睛都快眯成一条缝了，现在倒不好意思了？", 头像: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg", 特殊: "白粥嘴角勾起调侃的笑意，眼神慵懒地看着十一。"},
                    {角色: "十一", 文本: "白粥姐姐！你、你别这么说嘛…我只是觉得和主角哥哥一起拍照很开心，没有别的意思…", 头像: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg"},
                    {角色: gameData.playerName, 文本: "白粥你就别调侃她了，十一本来就容易害羞，刚刚拍摄的时候表现已经很好了。"},
                    {角色: "白粥", 文本: "行行行，护着你的小甜妹吧。", 头像: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg", 特殊: "白粥耸耸肩，端起茶盏抿了一口，眼神中闪过一丝不易察觉的情绪。"},
                    {角色: "稀音", 文本: "主角哥哥说得对，十一妹妹年纪小，容易害羞，白粥姐姐确实不该这么调侃她。", 头像: "https://free.picui.cn/free/2025/12/14/693e44f6b4b9e.jpg", 特殊: "稀音在说这句话的时候，指尖悄悄攥紧了放在膝盖上的裙摆。"},
                    {角色: "骑士", 文本: "接下来的拍摄计划，我之前和大家说过，先拍一组古风风格的单人照...", 头像: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg"}
                ],
                选项: [
                    {文本: "看向稀音，对她微笑表示支持", 好感度变化: {稀音: 5}, 下一场景: 1},
                    {文本: "为十一解围，转移话题", 好感度变化: {十一: 5}, 下一场景: 1},
                    {文本: "调侃白粥，活跃气氛", 好感度变化: {白粥: 5}, 下一场景: 1},
                    {文本: "询问骑士接下来的拍摄细节", 好感度变化: {骑士: 5}, 下一场景: 1}
                ]
            },
            
            1: {
                场景描述: "十分钟的休息时间过去了，骑士已经检查完相机设备，大家开始按照计划进行拍摄。",
                对话: [
                    {角色: "骑士", 文本: "设备都没问题，我们现在开始拍摄吧，先去竹林那边拍白粥的单人照。", 头像: "https://free.picui.cn/free/2025/12/14/693e44f7246fa.jpg"},
                    {角色: gameData.playerName, 文本: "好，我跟你去竹林那边，帮你搭把手调整一下道具。"},
                    {角色: "稀音", 文本: "主角哥哥要去和白粥姐姐拍照片了...", 头像: "https://free.picui.cn/free/2025/12/14/693e44f6b4b9e.jpg", 特殊: "稀音看着你离开的背影，眼神里的温柔瞬间褪去。"},
                    {角色: "十一", 文本: "主角哥哥，等下白粥姐姐拍完照片，我们就可以拍互动镜头了对吗？我想拍牵手的镜头，还要拍靠在你肩膀上的镜头！", 头像: "https://free.picui.cn/free/2025/12/14/693e381736408.jpg"},
                    {角色: gameData.playerName, 文本: "当然可以，只要你喜欢，拍什么互动镜头都可以。"},
                    {角色: "白粥", 文本: "某人这是开启了照顾模式啊？不过不用特意担心我，我可没那么娇弱。", 头像: "https://free.picui.cn/free/2025/12/14/693e373f18eaa.jpg", 特殊: "白粥挑了挑眉，语气中带着调侃，但眼神里有一丝暖意。"}
                ],
                选项: [
                    {文本: "专心帮骑士准备拍摄", 好感度变化: {骑士: 5}, 下一场景: 2},
                    {文本: "安慰稀音，让她别担心", 好感度变化: {稀音: 10}, 下一场景: 2, 隐藏检查: "稀音"},
                    {文本: "和十一聊聊等下的拍摄", 好感度变化: {十一: 5}, 下一场景: 2},
                    {文本: "回应白粥的调侃", 好感度变化: {白粥: 5}, 下一场景: 2}
                ]
            }
        };

        // ==============================
        // DOM元素
        // ==============================
        const screens = {
            title: document.getElementById('title-screen'),
            nameCreation: document.getElementById('name-creation-screen'),
            characterSelect: document.getElementById('character-select-screen'),
            game: document.getElementById('game-screen'),
            ending: document.getElementById('ending-screen'),
            endingsGallery: document.getElementById('endings-gallery'),
            statusBar: document.getElementById('status-bar')
        };
        
        const uiElements = {
            startBtn: document.getElementById('start-btn'),
            endingsBtn: document.getElementById('endings-btn'),
            playerNameInput: document.getElementById('player-name'),
            confirmNameBtn: document.getElementById('confirm-name-btn'),
            characterCards: document.querySelectorAll('.character-card'),
            confirmCharacterBtn: document.getElementById('confirm-character-btn'),
            sceneDescription: document.getElementById('scene-description'),
            dialogueContainer: document.getElementById('dialogue-container'),
            optionsContainer: document.getElementById('options-container'),
            playerNameDisplay: document.getElementById('player-name-display'),
            mainCharacterDisplay: document.getElementById('main-character-display'),
            routeDisplay: document.getElementById('route-display'),
            healthDisplay: document.getElementById('health-display'),
            healthFill: document.getElementById('health-fill'),
            selectionConfirm: document.getElementById('selection-confirm'),
            confirmTitle: document.getElementById('confirm-title'),
            confirmText: document.getElementById('confirm-text'),
            confirmYes: document.getElementById('confirm-yes'),
            confirmNo: document.getElementById('confirm-no'),
            backToTitleFromGallery: document.getElementById('back-to-title-from-gallery'),
            endingsGrid: document.getElementById('endings-grid'),
            unlockedCount: document.getElementById('unlocked-count')
        };
        
        // ==============================
        // 游戏状态
        // ==============================
        let currentSelection = null;
        let pendingChoice = null;
        
        // ==============================
        // 游戏函数
        // ==============================
        
        // 初始化游戏
        function initGame() {
            // 检查是否有保存的游戏
            if (gameData.load()) {
                showScreen('game');
                updateStatusBar();
                loadScene(gameData.currentScene);
            } else {
                showScreen('title');
            }
            
            // 事件监听
            uiElements.startBtn.addEventListener('click', () => {
                showScreen('nameCreation');
            });
            
            uiElements.endingsBtn.addEventListener('click', () => {
                showEndingsGallery();
            });
            
            uiElements.confirmNameBtn.addEventListener('click', confirmName);
            
            uiElements.playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmName();
            });
            
            uiElements.characterCards.forEach(card => {
                card.addEventListener('click', () => {
                    uiElements.characterCards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    currentSelection = card.dataset.character;
                });
            });
            
            uiElements.confirmCharacterBtn.addEventListener('click', confirmCharacter);
            
            uiElements.confirmYes.addEventListener('click', () => {
                if (pendingChoice) {
                    handleChoice(pendingChoice);
                    hideSelectionConfirm();
                }
            });
            
            uiElements.confirmNo.addEventListener('click', hideSelectionConfirm);
            
            uiElements.backToTitleFromGallery?.addEventListener('click', () => {
                showScreen('title');
            });
        }
        
        // 显示指定屏幕
        function showScreen(screenName) {
            Object.values(screens).forEach(screen => {
                if (screen !== screens.statusBar) {
                    screen.classList.add('hidden');
                }
            });
            
            if (screenName === 'game') {
                screens.game.classList.remove('hidden');
                screens.statusBar.classList.remove('hidden');
            } else {
                screens[screenName]?.classList.remove('hidden');
                screens.statusBar.classList.add('hidden');
            }
        }
        
        // 确认名字
        function confirmName() {
            const name = uiElements.playerNameInput.value.trim();
            if (name.length < 2 || name.length > 10) {
                alert('名字长度应在2-10个字符之间');
                return;
            }
            
            gameData.playerName = name;
            showScreen('characterSelect');
        }
        
        // 确认角色选择
        function confirmCharacter() {
            if (!currentSelection) {
                alert('请选择一位攻略对象');
                return;
            }
            
            gameData.selectedCharacter = currentSelection;
            gameData.relationships[currentSelection].好感度 += 10; // 初始好感度加成
            
            // 更新显示
            uiElements.playerNameDisplay.textContent = gameData.playerName;
            uiElements.mainCharacterDisplay.textContent = currentSelection;
            uiElements.routeDisplay.textContent = gameData.currentRoute;
            
            // 保存并开始游戏
            gameData.save();
            showScreen('game');
            loadScene(0);
        }
        
        // 加载场景
        function loadScene(sceneId) {
            const scene = gameScenes[sceneId];
            if (!scene) {
                console.error(`场景 ${sceneId} 不存在`);
                return;
            }
            
            gameData.currentScene = sceneId;
            
            // 更新场景描述
            uiElements.sceneDescription.textContent = scene.场景描述;
            
            // 清空对话和选项
            uiElements.dialogueContainer.innerHTML = '';
            uiElements.optionsContainer.innerHTML = '';
            
            // 添加对话
            scene.对话.forEach(dialogue => {
                const dialogueElement = document.createElement('div');
                dialogueElement.className = 'character-dialogue';
                
                // 替换对话中的"主角"为玩家名字
                let dialogueText = dialogue.文本.replace(/主角/g, gameData.playerName);
                
                // 为角色名添加特殊样式
                let characterNameClass = "character-name";
                if (dialogue.角色 === "夏梦") {
                    characterNameClass += " summer";
                }
                
                dialogueElement.innerHTML = `
                    <div class="${characterNameClass}">${dialogue.角色 === gameData.playerName ? gameData.playerName : dialogue.角色}</div>
                    <div class="dialogue-text">${dialogueText}</div>
                `;
                
                // 添加头像（如果不是玩家）
                if (dialogue.角色 !== gameData.playerName && dialogue.头像) {
                    const avatar = document.createElement('img');
                    avatar.className = 'character-avatar';
                    avatar.src = dialogue.头像;
                    avatar.alt = dialogue.角色;
                    dialogueElement.appendChild(avatar);
                }
                
                // 添加特殊描述
                if (dialogue.特殊) {
                    const special = document.createElement('div');
                    special.className = 'hidden-trigger';
                    special.textContent = dialogue.特殊.replace(/主角/g, gameData.playerName);
                    dialogueElement.appendChild(special);
                }
                
                uiElements.dialogueContainer.appendChild(dialogueElement);
            });
            
            // 添加选项
            scene.选项.forEach((option, index) => {
                // 检查条件
                if (option.condition && !option.condition()) {
                    return;
                }
                
                // 检查隐藏触发
                if (option.隐藏检查 && gameData.selectedCharacter === option.隐藏检查) {
                    if (Math.random() < 0.1) {
                        gameData.hiddenTriggered = true;
                    }
                }
                
                const optionElement = document.createElement('button');
                optionElement.className = 'option-btn';
                if (option.danger) optionElement.classList.add('danger');
                
                optionElement.textContent = option.文本;
                optionElement.dataset.index = index;
                
                optionElement.addEventListener('click', () => {
                    // 如果有好感度变化，显示确认
                    if (option.好感度变化 || option.结局 || option.路线) {
                        showSelectionConfirm(option);
                    } else {
                        handleChoice(option);
                    }
                });
                
                uiElements.optionsContainer.appendChild(optionElement);
            });
            
            // 滚动到底部
            setTimeout(() => {
                uiElements.dialogueContainer.scrollTop = uiElements.dialogueContainer.scrollHeight;
            }, 100);
            
            // 更新状态栏
            updateStatusBar();
            
            // 保存游戏
            gameData.save();
        }
        
        // 显示选择确认
        function showSelectionConfirm(option) {
            pendingChoice = option;
            
            let confirmMessage = "你确定要选择这个选项吗？";
            if (option.好感度变化) {
                const changes = [];
                for (const [character, value] of Object.entries(option.好感度变化)) {
                    changes.push(`${character}: ${value > 0 ? '+' : ''}${value}`);
                }
                confirmMessage += `<br>好感度变化: ${changes.join(', ')}`;
            }
            
            if (option.路线) {
                confirmMessage += `<br>路线变更: ${option.路线}`;
            }
            
            uiElements.confirmText.innerHTML = confirmMessage;
            uiElements.selectionConfirm.classList.remove('hidden');
        }
        
        // 隐藏选择确认
        function hideSelectionConfirm() {
            uiElements.selectionConfirm.classList.add('hidden');
            pendingChoice = null;
        }
        
        // 处理选择
        function handleChoice(option) {
            // 记录选择
            gameData.choices.push({
                场景: gameData.currentScene,
                选项: option.文本,
                时间: new Date().toISOString()
            });
            
            // 更新好感度
            if (option.好感度变化) {
                for (const [character, value] of Object.entries(option.好感度变化)) {
                    if (gameData.relationships[character]) {
                        gameData.relationships[character].好感度 += value;
                        // 限制好感度在0-100之间
                        gameData.relationships[character].好感度 = Math.max(0, Math.min(100, gameData.relationships[character].好感度));
                    }
                }
            }
            
            // 更新路线
            if (option.路线) {
                gameData.currentRoute = option.路线;
            }
            
            // 消耗体力
            if (option.staminaCost) {
                gameData.consumeStamina(option.staminaCost);
            }
            
            // 检查是否触发结局
            if (option.结局) {
                showEnding(option.结局);
                return;
            }
            
            // 否则加载下一场景
            if (option.下一场景 !== undefined) {
                loadScene(option.下一场景);
            }
            
            // 更新状态栏
            updateStatusBar();
            
            // 保存游戏
            gameData.save();
        }
        
        // 显示结局
        function showEnding(endingName) {
            const ending = gameEndings[endingName];
            if (!ending) {
                console.error(`结局 ${endingName} 不存在`);
                return;
            }
            
            // 添加到已解锁结局
            if (!gameData.endingsUnlocked.includes(endingName)) {
                gameData.endingsUnlocked.push(endingName);
                gameData.save();
            }
            
            // 更新结局屏幕
            const endingContainer = document.querySelector('.ending-container');
            endingContainer.innerHTML = `
                <h2 class="ending-title">${ending.标题}</h2>
                <img src="${ending.图片}" alt="${ending.标题}" class="ending-image">
                <div class="ending-description">${ending.描述.replace(/主角/g, gameData.playerName)}</div>
                <div style="margin-top: 20px; color: #666; font-size: 0.9rem;">
                    <i class="fas fa-tag"></i> 结局类型: ${ending.类型}
                </div>
                <div class="ending-stats">
                    <div class="stat-item">
                        <div class="stat-value">${gameData.endingsUnlocked.length}</div>
                        <div class="stat-label">已解锁结局</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${gameData.health}</div>
                        <div class="stat-label">最终健康度</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${gameData.choices.length}</div>
                        <div class="stat-label">总选择数</div>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button id="restart-btn" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> 重新开始
                    </button>
                    <button id="back-to-title-btn" class="btn">
                        <i class="fas fa-home"></i> 返回标题
                    </button>
                    <button id="view-endings-btn" class="btn">
                        <i class="fas fa-trophy"></i> 查看结局
                    </button>
                </div>
            `;
            
            showScreen('ending');
            
            // 添加事件监听
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('back-to-title-btn').addEventListener('click', () => {
                showScreen('title');
            });
            document.getElementById('view-endings-btn').addEventListener('click', () => {
                showEndingsGallery();
            });
        }
        
        // 显示结局画廊
        function showEndingsGallery() {
            const endingsGrid = document.getElementById('endings-grid');
            endingsGrid.innerHTML = '';
            
            let unlockedCount = 0;
            
            Object.entries(gameEndings).forEach(([endingName, ending], index) => {
                const isUnlocked = gameData.endingsUnlocked.includes(endingName);
                if (isUnlocked) unlockedCount++;
                
                const endingCard = document.createElement('div');
                endingCard.className = `ending-card ${isUnlocked ? '' : 'locked'}`;
                endingCard.innerHTML = `
                    <div class="ending-icon">
                        <i class="${ending.图标}"></i>
                    </div>
                    <div class="ending-card-title">${ending.标题}</div>
                    <div class="ending-card-type">${ending.类型}</div>
                `;
                
                if (isUnlocked) {
                    endingCard.addEventListener('click', () => {
                        showEnding(endingName);
                    });
                }
                
                endingsGrid.appendChild(endingCard);
            });
            
            document.getElementById('unlocked-count').textContent = unlockedCount;
            showScreen('endings-gallery');
        }
        
        // 重新开始游戏
        function restartGame() {
            if (confirm('确定要重新开始游戏吗？当前进度将丢失。')) {
                gameData.reset();
                showScreen('nameCreation');
            }
        }
        
        // 更新状态栏
        function updateStatusBar() {
            uiElements.playerNameDisplay.textContent = gameData.playerName;
            uiElements.mainCharacterDisplay.textContent = gameData.selectedCharacter || "未选择";
            uiElements.routeDisplay.textContent = gameData.currentRoute;
            
            // 更新健康度
            uiElements.healthDisplay.textContent = gameData.health;
            uiElements.healthFill.style.width = `${gameData.health}%`;
            
            // 更新健康条颜色
            uiElements.healthFill.className = 'health-fill';
            if (gameData.health <= 30) {
                uiElements.healthFill.classList.add('health-critical');
            } else if (gameData.health <= 60) {
                uiElements.healthFill.classList.add('health-low');
            }
            
            // 更新角色卡片上的好感度显示
            uiElements.characterCards.forEach(card => {
                const character = card.dataset.character;
                if (character && gameData.relationships[character]) {
                    const moodIndicator = card.querySelector('.mood-indicator span:last-child');
                    if (moodIndicator) {
                        moodIndicator.textContent = `好感度: ${gameData.relationships[character].好感度}`;
                    }
                }
            });
        }
        
        // ==============================
        // 页面加载完成后初始化游戏
        // ==============================
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
